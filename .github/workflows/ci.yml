name: CI

on:
  push:
    branches: ["**"]
  pull_request:

permissions:
  contents: read

jobs:
  build-and-test:
    runs-on: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Setup MSYS2 (UCRT64)
        uses: msys2/setup-msys2@v2
        with:
          msystem: UCRT64
          update: true
          install: >-
            mingw-w64-ucrt-x86_64-gcc
            mingw-w64-ucrt-x86_64-cmake
            mingw-w64-ucrt-x86_64-ninja
            mingw-w64-ucrt-x86_64-qt6-base

      - name: Configure (Debug)
        shell: pwsh
        run: cmake --preset debug

      - name: Build (Debug)
        shell: pwsh
        run: cmake --build --preset debug --parallel

      - name: Test (Debug)
        shell: pwsh
        run: ctest --preset debug

      - name: Configure (Release)
        shell: pwsh
        run: cmake --preset release

      - name: Build (Release)
        shell: pwsh
        run: cmake --build --preset release --parallel
